<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Anonim Oyun</title>
</head>
<body>

<h2>Anonim Mesaj GÃ¶ndÉ™r</h2>

<input type="text" id="name" placeholder="AdÄ±nÄ±zÄ± yazÄ±n"><br><br>
<textarea id="message" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n"></textarea><br><br>
<button onclick="sendMessage()">GÃ¶ndÉ™r</button>

<p id="status"></p>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabaseUrl = "https://gkrfcoyleewxrxbfdunq.supabase.co";
const supabaseKey = "sb_publishable_E1QDjV9fAt2IaoI3h7G9Iw_hIiSaAFH";

const supabase = createClient(supabaseUrl, supabaseKey);
const adminPassword = "service.2000";

// ğŸ”¹ Mesaj gÃ¶ndÉ™rmÉ™
window.sendMessage = async function() {
  const name = document.getElementById("name").value;
  const message = document.getElementById("message").value;

  if (!name || !message) {
    document.getElementById("status").innerText = "BÃ¼tÃ¼n xanalarÄ± doldurun!";
    return;
  }

  const { error } = await supabase
    .from("messages")
    .insert([{ name: name, message: message }]);

  if (error) {
    document.getElementById("status").innerText = "XÉ™ta: " + error.message;
  } else {
    document.getElementById("status").innerText = "Mesaj gÃ¶ndÉ™rildi!";
  }
};


// ğŸ” Admin yoxlamasÄ±
const urlParams = new URLSearchParams(window.location.search);
const kod = urlParams.get("kod");

if (kod === adminPassword) {
  loadMessages();
}

async function loadMessages() {
  const { data, error } = await supabase
    .from("messages")
    .select("*")
    .order("id", { ascending: false });

  if (error) {
    console.error(error);
    return;
  }

  const container = document.createElement("div");
  container.innerHTML = "<h2>GÉ™lÉ™n Mesajlar:</h2>";

  data.forEach(msg => {
    const div = document.createElement("div");
    div.style.border = "1px solid black";
    div.style.padding = "10px";
    div.style.marginBottom = "10px";

    const text = document.createElement("p");
    text.textContent = msg.name + ": " + msg.message;

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Sil";
    deleteBtn.onclick = async () => {
      await supabase
        .from("messages")
        .delete()
        .eq("id", msg.id);

      div.remove();
    };

    div.appendChild(text);
    div.appendChild(deleteBtn);
    container.appendChild(div);
  });

  document.body.appendChild(container);
}
</script>

</body>
</html>
